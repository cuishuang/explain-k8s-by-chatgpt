# File: pkg/controller/nodeipam/ipam/multi_cidr_range_allocator.go

pkg/controller/nodeipam/ipam/multi_cidr_range_allocator.go是Kubernetes中负责IP地址管理的控制器之一。其作用是为节点分配CIDR（Classless Inter-Domain Routing，无类域间路由选择）地址。

multiCIDRNodeReservedCIDRs定义了已保留的节点CIDR范围列表，multiCIDRRangeAllocator定义了一个多CIDR地址分配器，用于节点使用。

NewMultiCIDRRangeAllocator函数用于创建一个新的CIDR地址分配器。Run函数开启IP地址管理器的处理逻辑。runCIDRWorker函数处理CIDR地址的分配和释放逻辑，processNextCIDRWorkItem为该函数处理CIDR地址分配逻辑的核心函数。runNodeWorker函数处理新增节点和节点删除事件，processNextNodeWorkItem为该函数处理节点事件的核心函数。

syncNode函数用于同步节点的CIDR地址，needToAddFinalizer函数用于为node添加CIDR地址释放逻辑的finalizer，syncClusterCIDR函数用于同步集群的CIDR地址。occupyCIDRs函数用于占用CIDR地址，associatedCIDRSet函数用于获取节点相关的CIDR地址集合，Occupy函数用于占用一个CIDR地址，Release函数用于释放一个CIDR地址，AllocateOrOccupyCIDR和ReleaseCIDR两个函数用于分配和释放CIDR地址。

filterOutServiceRange函数用于从CIDR地址列表中排除服务范围，occupyServiceCIDR函数用于占用服务CIDR地址，updateCIDRsAllocation函数用于更新CIDR地址分配。

defaultNodeSelector函数定义了默认的节点选择器，prioritizedCIDRs和allocateCIDR两个函数用于对CIDR地址进行优先级排序和分配，cidrInAllocatedList函数用于判断某个CIDR地址是否已经被占用，cidrOverlapWithAllocatedList函数用于判断待分配的CIDR地址是否与已分配的CIDR地址重叠，allocatedClusterCIDR函数用于获取分配给集群的CIDR地址。

orderedMatchingClusterCIDRs函数用于获取匹配集合标签的CIDR地址集合，matchCIDRLabels函数用于判断CIDR地址集合是否符合匹配标准，createDefaultClusterCIDR函数用于创建默认CIDR地址，reconcileCreate和reconcileBootstrap函数用于创建一个新的CIDR地址分配器，createClusterCIDR函数用于创建CIDR地址，createClusterCIDRSet函数用于创建CIDR地址集合，mapClusterCIDRSet函数用于映射CIDR地址集合，reconcileDelete函数用于删除CIDR地址分配器，并且设置finalizer，deleteClusterCIDR函数用于删除CIDR地址。nodeSelectorKey函数将CIDR地址转换为Node选择器，listClusterCIDRs函数用于列举所有集群CIDR地址，nodeSelectorRequirementsAsLabelRequirements函数将Node选择器转换为标签选择器，nodeSelectorAsSelector函数将Node选择器转换为选择器。

