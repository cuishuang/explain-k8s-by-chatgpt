# File: pkg/controller/deployment/util/deployment_util.go

pkg/controller/deployment/util/deployment_util.go是Kubernetes Deployment Controller的核心文件之一。该文件中定义了各种Deployment控制器相关的辅助方法，用于在Kubernetes中创建、更新和删除部署，以及处理部署的相关事件和条件。

annotationsToSkip保存了应该跳过的注释的列表。这些注释包括kubectl.kubernetes.io/last-applied-configuration，由kubectl更新操作自动添加，以防止重复创建，以及部署控制器自己添加的状态注释。nowFn是一个函数，用于返回当前时间的时间戳，以便推断部署的活动时间。

RsListFunc、podListFunc和ReplicaSetsByRevision是结构体类型，用于在处理Deployment过程中使用。RsListFunc是一个函数类型，用于获取当前ReplicaSet的列表。podListFunc是一个函数类型，用于获取当前Pod的列表。ReplicaSetsByRevision是一个映射，用于存储具有特定Revision的ReplicaSet列表，以便在执行滚动更新时进行使用。

NewDeploymentCondition用于创建新的Deployment条件。GetDeploymentCondition用于获取已有的Deployment条件。SetDeploymentCondition用于设置Deployment条件。RemoveDeploymentCondition用于删除Deployment条件。filterOutCondition用于过滤其他条件并返回特定类型的条件。ReplicaSetToDeploymentCondition将ReplicaSet转换为Deployment条件。SetDeploymentRevision用于设置Deployment的Revision。MaxRevision、LastRevision和Revision等函数则返回有关ReplicaSet的Revision的信息。SetNewReplicaSetAnnotations、skipCopyAnnotation、copyDeploymentAnnotationsToReplicaSet、SetDeploymentAnnotationsTo、getSkippedAnnotations等函数用于处理ReplicaSet和Deployment之间的注释。FindActiveOrLatest、GetDesiredReplicasAnnotation、getMaxReplicasAnnotation和getIntFromAnnotation等函数用于解析注释和处理部署状态。SetReplicasAnnotations、ReplicasAnnotationsNeedUpdate、MaxUnavailable、MinAvailable、MaxSurge、GetProportion、getReplicaSetFraction、RsListFromClient、ListReplicaSets和ListPods等函数用于处理ReplicaSet和Pod列表。EqualIgnoreHash、FindNewReplicaSet、FindOldReplicaSets、SetFromReplicaSetTemplate、GetReplicaCountForReplicaSets、GetActualReplicaCountForReplicaSets、GetReadyReplicaCountForReplicaSets和GetAvailableReplicaCountForReplicaSets等函数可以帮助判断并处理部署的状态。IsRollingUpdate、DeploymentComplete、DeploymentProgressing、DeploymentTimedOut、NewRSNewReplicas、IsSaturated、WaitForObservedDeployment等函数用于处理部署控制器中的滚动更新和事件问题。ResolveFenceposts、HasProgressDeadline、HasRevisionHistoryLimit和GetDeploymentsForReplicaSet等函数则用于限制部署控制器的行为和规则。

在总体上，pkg/controller/deployment/util/deployment_util.go主要用于协助部署控制器处理和维护部署的状态，包括解析注释、处理条件、判断状态、更新列表和处理事件等方面。这个文件是Kubernetes Deployment控制器的关键，其功能的稳定性和准确性对于Kubernetes集群的稳定性和高可用性具有极其重要的意义。

